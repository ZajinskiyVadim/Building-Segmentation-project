# üéì –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–¥–∞–Ω–∏–π –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–∞—Ö

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ –∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏](#1-–≤–≤–µ–¥–µ–Ω–∏–µ-–∏-–ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–¥–∞—á–∏)
2. [–î–∞—Ç–∞—Å–µ—Ç INRIA](#2-–¥–∞—Ç–∞—Å–µ—Ç-inria)
3. [–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#3-—ç—Ç–∞–ø-1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
4. [–≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏](#4-—ç—Ç–∞–ø-2-—Å–æ–∑–¥–∞–Ω–∏–µ-–∏-–æ–±—É—á–µ–Ω–∏–µ-–º–æ–¥–µ–ª–∏)
5. [–≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏](#5-—ç—Ç–∞–ø-3-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏)
6. [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–≤–æ–¥—ã](#6-—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-–∏-–≤—ã–≤–æ–¥—ã)
7. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#7-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

### üéØ –ß—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏?

**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∑–¥–∞–Ω–∏—è –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–∞—Ö –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–ª–æ—â–∞–¥—å.

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ (–∞–Ω–∞–ª–∏–∑ –∑–∞—Å—Ç—Ä–æ–π–∫–∏)
- –ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π —É—á—ë—Ç
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
- –û—Ü–µ–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

### üìä –¢–∏–ø –∑–∞–¥–∞—á–∏

**–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è** - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∏–∫—Å–µ–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å: —ç—Ç–æ –∑–¥–∞–Ω–∏–µ –∏–ª–∏ —Ñ–æ–Ω.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –¶–≤–µ—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 5000√ó5000 –ø–∏–∫—Å–µ–ª–µ–π (RGB)
–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –ß—ë—Ä–Ω–æ-–±–µ–ª–∞—è –º–∞—Å–∫–∞ 5000√ó5000 –ø–∏–∫—Å–µ–ª–µ–π (0 = —Ñ–æ–Ω, 1 = –∑–¥–∞–Ω–∏–µ)

---

## 2. –î–∞—Ç–∞—Å–µ—Ç INRIA

### üì¶ –ß—Ç–æ —ç—Ç–æ?

**INRIA Aerial Image Labeling Dataset** - –ø—É–±–ª–∏—á–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –æ—Ç —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Å—Ç–∏—Ç—É—Ç–∞.

### üìä –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–í—Å–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** | 360 (180 train + 180 test) |
| **–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** | 5000 √ó 5000 –ø–∏–∫—Å–µ–ª–µ–π |
| **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ** | 0.3 –º–µ—Ç—Ä–∞ –Ω–∞ –ø–∏–∫—Å–µ–ª—å |
| **–ü–ª–æ—â–∞–¥—å –æ–¥–Ω–æ–≥–æ —Å–Ω–∏–º–∫–∞** | ~2.25 –∫–º¬≤ |
| **–ì–æ—Ä–æ–¥–∞** | 10 (–°–®–ê –∏ –ê–≤—Å—Ç—Ä–∏—è) |
| **–ö–ª–∞—Å—Å—ã** | 2 (–∑–¥–∞–Ω–∏–µ / –Ω–µ –∑–¥–∞–Ω–∏–µ) |

### üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è

**Train set (–æ–±—É—á–µ–Ω–∏–µ):**
- Austin, Texas üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Chicago, Illinois üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Kitsap County, Washington üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Tyrol West, Austria üá¶üáπ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Vienna, Austria üá¶üáπ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

**Test set (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ):**
- Bellingham, Washington üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Bloomington, Indiana üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Innsbruck, Austria üá¶üáπ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- San Francisco, California üá∫üá∏ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- Tyrol East, Austria üá¶üáπ (36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

### ‚ö†Ô∏è –í–∞–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å

**Test set –ù–ï –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö Ground Truth –º–∞—Å–æ–∫!**

–ü–æ—ç—Ç–æ–º—É –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **train set** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ test split:
- 144 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí –æ–±—É—á–µ–Ω–∏–µ (80%)
- 36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Üí —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (20%)

---

## 3. –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ—Å–µ—Ç–∏:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
2. –†–∞–∑–±–∏—Ç—å –±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–∞—Ç—á–∏
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
4. –°–æ–∑–¥–∞—Ç—å DataLoader –¥–ª—è PyTorch

---

### –®–∞–≥ 1.1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

**–°–∫—Ä–∏–ø—Ç:** `download_dataset.py`

```bash
python download_dataset.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–∫–∞—á–∏–≤–∞–µ—Ç –∞—Ä—Ö–∏–≤ —Å –¥–∞—Ç–∞—Å–µ—Ç–æ–º (~20 GB)
2. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤ –ø–∞–ø–∫—É `data/AerialImageDataset/`
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:**
```
data/AerialImageDataset/
‚îú‚îÄ‚îÄ train/
‚îÇ   ‚îú‚îÄ‚îÄ images/          # 180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π RGB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ austin1.tif
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ austin2.tif
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ gt/              # 180 –º–∞—Å–æ–∫ (Ground Truth)
‚îÇ       ‚îú‚îÄ‚îÄ austin1.tif
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ test/
    ‚îî‚îÄ‚îÄ images/          # 180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–±–µ–∑ –º–∞—Å–æ–∫!)
```

---

### –®–∞–≥ 1.2: –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –ø–∞—Ç—á–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è 5000√ó5000 —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –¥–ª—è GPU.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑—Ä–µ–∑–∞–µ–º –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–∞—Ç—á–∏ 512√ó512 –ø–∏–∫—Å–µ–ª–µ–π.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
–ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:    –ü–∞—Ç—á–∏:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ      ‚îÇ 1 ‚îÇ 2 ‚îÇ 3 ‚îÇ 4 ‚îÇ
‚îÇ   5000 x 5000   ‚îÇ  ‚Üí   ‚îú‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 ‚îÇ      ‚îÇ 5 ‚îÇ 6 ‚îÇ 7 ‚îÇ 8 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îò
                         –ö–∞–∂–¥—ã–π: 512x512
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∑–±–∏–≤–∫–∏:**

| –ù–∞–±–æ—Ä | Patch size | Stride | –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ | –ü–∞—Ç—á–µ–π –∏–∑ 1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
|-------|------------|--------|------------|-------------------------|
| Train | 512 | 256 | 50% | 324 –ø–∞—Ç—á–∞ |
| Val | 512 | 512 | 0% | 81 –ø–∞—Ç—á |
| Test | 512 | 512 | 0% | 81 –ø–∞—Ç—á |

**–ü–æ—á–µ–º—É –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–ª—è train?**
- –ë–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è (–∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è)
- 180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π √ó 324 –ø–∞—Ç—á–∞ = **58,320 –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤**

---

### –®–∞–≥ 1.3: –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª—å:** –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:**

```python
# 1. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ (50%)
HorizontalFlip(p=0.5)

# 2. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ (50%)
VerticalFlip(p=0.5)

# 3. –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ 90¬∞ (50%)
RandomRotate90(p=0.5)

# 4. –ì–∞—É—Å—Å–æ–≤ —à—É–º –∏–ª–∏ –±–ª—é—Ä (30%)
OneOf([
    GaussNoise(std_range=(0.02, 0.1)),
    GaussianBlur(blur_limit=(3, 7))
], p=0.3)

# 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —è—Ä–∫–æ—Å—Ç–∏/–∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞/–Ω–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç–∏ (30%)
ColorJitter(brightness=0.2, contrast=0.2, saturation=0.2, hue=0.1, p=0.3)

# 6. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–≤—Å–µ–≥–¥–∞)
# mean = [0.485, 0.456, 0.406]  # ImageNet —Å—Ç–∞–Ω–¥–∞—Ä—Ç
# std = [0.229, 0.224, 0.225]
```

**–ü—Ä–∏–º–µ—Ä:**
```
–û—Ä–∏–≥–∏–Ω–∞–ª  ‚Üí  Flip  ‚Üí  Rotate  ‚Üí  Noise  ‚Üí  Color
   üè†         üè†         üè†         üè†          üè†
  ‚îå‚îÄ‚îê       ‚îå‚îÄ‚îê        ‚îå‚îê        ‚îå‚îÄ‚îê        ‚îå‚îÄ‚îê
  ‚îî‚îÄ‚îò       ‚îî‚îÄ‚îò        ‚îî‚îò        ‚îî‚îÄ‚îò        ‚îî‚îÄ‚îò
```

---

### –®–∞–≥ 1.4: DataLoader

**–§–∞–π–ª:** `src/dataset.py`

**–ö–ª–∞—Å—Å `INRIADataset`:**
```python
dataset = INRIADataset(
    data_root='data/AerialImageDataset',
    split='train',              # train / val / test
    patch_size=512,             # –†–∞–∑–º–µ—Ä –ø–∞—Ç—á–∞
    stride=256,                 # –®–∞–≥ (–¥–ª—è –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è)
    transform=augmentations,    # –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
    normalize=True              # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. –í—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–∞—Ç—á–µ–π (y, x)
3. –ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ `dataset[i]`:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω—É–∂–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   - –í—ã—Ä–µ–∑–∞–µ—Ç –ø–∞—Ç—á –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{'image': tensor, 'mask': tensor}`

**PyTorch DataLoader:**
```python
train_loader = DataLoader(
    dataset=train_dataset,
    batch_size=32,              # –ü–∞—Ç—á–µ–π –≤ –±–∞—Ç—á–µ
    shuffle=True,               # –ü–µ—Ä–µ–º–µ—à–∏–≤–∞—Ç—å
    num_workers=0,              # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (0 –¥–ª—è Windows)
    pin_memory=True             # –£—Å–∫–æ—Ä–µ–Ω–∏–µ GPU
)
```

**–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- Train: 58,320 –ø–∞—Ç—á–µ–π ‚Üí 1,822 –±–∞—Ç—á–∞ (batch_size=32)
- Val: 14,580 –ø–∞—Ç—á–µ–π ‚Üí 456 –±–∞—Ç—á–µ–π
- Test: 2,916 –ø–∞—Ç—á–µ–π ‚Üí 91 –±–∞—Ç—á

---

### üìä –ò—Ç–æ–≥ –≠—Ç–∞–ø–∞ 1

‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã  
‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –ø–∞—Ç—á–∏ 512√ó512  
‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö  
‚úÖ –°–æ–∑–¥–∞–Ω DataLoader –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏  
‚úÖ –ì–æ—Ç–æ–≤–æ ~58,000 –æ–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤  

**–§–∞–π–ª—ã:**
- `src/dataset.py` - –∫–∞—Å—Ç–æ–º–Ω—ã–π Dataset
- `notebooks/01_dataset_exploration.ipynb` - –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## 4. –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

### üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

1. –í—ã–±—Ä–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Ç–µ—Ä—å (loss)
3. –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å
4. –î–æ—Å—Ç–∏—á—å IoU > 0.60

---

### –®–∞–≥ 2.1: –í—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–í—ã–±—Ä–∞–ª–∏:** U-Net —Å ResNet50 encoder

#### –ü–æ—á–µ–º—É U-Net?

**U-Net** - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
        Encoder (‚Üì)              Decoder (‚Üë)
Input ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Output
  ‚îÇ                   ‚îÇ  ‚îÇ
  ‚îú‚Üí Conv + Pool ‚Üí E1 ‚îú‚îÄ‚îÄ‚îº‚Üí E1 + Upsample ‚Üí D1
  ‚îÇ                   ‚îÇ  ‚îÇ
  ‚îú‚Üí Conv + Pool ‚Üí E2 ‚îú‚îÄ‚îÄ‚îº‚Üí E2 + Upsample ‚Üí D2
  ‚îÇ                   ‚îÇ  ‚îÇ
  ‚îú‚Üí Conv + Pool ‚Üí E3 ‚îú‚îÄ‚îÄ‚îº‚Üí E3 + Upsample ‚Üí D3
  ‚îÇ                   ‚îÇ  ‚îÇ
  ‚îî‚Üí Conv + Pool ‚Üí E4 ‚îî‚îÄ‚îÄ‚îò‚Üí E4 + Upsample ‚Üí D4
         ‚Üì                            ‚Üì
      Bottleneck                   Output
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **Encoder** (—Å–∂–∞—Ç–∏–µ): –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ (–∑–¥–∞–Ω–∏—è, —Ç–µ–∫—Å—Ç—É—Ä—ã)
- **Decoder** (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ): –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –º–∞—Å–∫–∏
- **Skip connections** (–ø–µ—Ä–µ–º—ã—á–∫–∏): –°–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–µ—Ç–∞–ª–∏

#### –ü–æ—á–µ–º—É ResNet50 encoder?

**ResNet50** - –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è —Å–µ—Ç—å –Ω–∞ ImageNet (1.2–ú –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–∂–µ –∑–Ω–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–∫—Ä–∞—è, —Ç–µ–∫—Å—Ç—É—Ä—ã, –æ–±—ä–µ–∫—Ç—ã)
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –æ–±—É—á–∞–µ—Ç—Å—è
- ‚úÖ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ

**–ö–æ–¥:**
```python
import segmentation_models_pytorch as smp

model = smp.Unet(
    encoder_name='resnet50',        # Backbone
    encoder_weights='imagenet',     # Pretrained –≤–µ—Å–∞
    in_channels=3,                  # RGB
    classes=1,                      # –ë–∏–Ω–∞—Ä–Ω–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è
    activation=None                 # Sigmoid –ø–æ–∑–∂–µ
)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏:**
- –í—Å–µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: **32,521,105**
- –û–±—É—á–∞–µ–º—ã—Ö: **32,521,105**
- –†–∞–∑–º–µ—Ä –≤ –ø–∞–º—è—Ç–∏: ~124 MB

---

### –®–∞–≥ 2.2: –§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å (Loss)

**–í—ã–±—Ä–∞–ª–∏:** –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Dice + BCE Loss

#### –ß—Ç–æ —Ç–∞–∫–æ–µ Loss?

**Loss (—Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å)** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–∞–≤–¥—ã.

**–¶–µ–ª—å –æ–±—É—á–µ–Ω–∏—è:** –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Loss.

#### Dice Loss

**Dice Coefficient** - –º–µ—Ç—Ä–∏–∫–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ –¥–≤—É—Ö –º–Ω–æ–∂–µ—Å—Ç–≤.

```
        2 √ó |A ‚à© B|
Dice = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        |A| + |B|

A = –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏ –∑–¥–∞–Ω–∏–π
B = –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–∏–∫—Å–µ–ª–∏ –∑–¥–∞–Ω–∏–π
‚à© = –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (True Positives)
```

**Dice Loss = 1 - Dice**

**–ü–æ—á–µ–º—É Dice?**
- ‚úÖ –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤ (–∑–¥–∞–Ω–∏–π –º–∞–ª–æ, —Ñ–æ–Ω–∞ –º–Ω–æ–≥–æ)
- ‚úÖ –§–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ –æ–±–ª–∞—Å—Ç–µ–π

#### BCE Loss (Binary Cross-Entropy)

**BCE** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è loss –¥–ª—è –±–∏–Ω–∞—Ä–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.

```
BCE = -[y √ó log(p) + (1-y) √ó log(1-p)]

y = ground truth (0 –∏–ª–∏ 1)
p = –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ (0.0 –¥–æ 1.0)
```

**–ü–æ—á–µ–º—É BCE?**
- ‚úÖ –•–æ—Ä–æ—à–æ –¥–ª—è –ø–æ–ø–∏–∫—Å–µ–ª—å–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ

#### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Loss

```python
Combined Loss = 0.5 √ó Dice Loss + 0.5 √ó BCE Loss
```

**–ó–∞—á–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å?**
- Dice ‚Üí –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–µ–π
- BCE ‚Üí —Ç–æ—á–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–∏–∫—Å–µ–ª—è
- –í–º–µ—Å—Ç–µ ‚Üí –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ!

**‚≠ê –≠—Ç–æ –¥–∞—ë—Ç +2 –±–∞–ª–ª–∞ –ø–æ –¢–ó –∑–∞ "–∫–æ–º–±–∏–Ω–∞—Ü–∏—é loss —Ñ—É–Ω–∫—Ü–∏–π"**

**–ö–æ–¥:**
```python
class BCEDiceLoss(nn.Module):
    def __init__(self, dice_weight=0.5, bce_weight=0.5):
        self.dice_weight = dice_weight
        self.bce_weight = bce_weight
        self.bce = nn.BCEWithLogitsLoss()
    
    def forward(self, pred, target):
        # BCE
        bce_loss = self.bce(pred, target)
        
        # Dice
        pred_sigmoid = torch.sigmoid(pred)
        intersection = (pred_sigmoid * target).sum()
        dice_coeff = (2 * intersection + 1) / (pred_sigmoid.sum() + target.sum() + 1)
        dice_loss = 1 - dice_coeff
        
        # Combine
        return self.bce_weight * bce_loss + self.dice_weight * dice_loss
```

---

### –®–∞–≥ 2.3: –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏

**–ú–µ—Ç—Ä–∏–∫–∏** - –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏.

#### IoU (Intersection over Union)

**–ì–ª–∞–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞!**

```
       TP
IoU = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      TP + FP + FN

TP = True Positives (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è)
FP = False Positives (–æ—à–∏–±–æ—á–Ω–æ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è)
FN = False Negatives (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è)
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ:  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà     Ground Truth:  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
              ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
              ‚ñà‚ñà‚ñà‚ñà                          ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà

–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ (TP): ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
                  ‚ñà‚ñà‚ñà‚ñà

–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
             ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
             ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà

IoU = 8 / 12 = 0.67
```

**–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** IoU > 0.60 (baseline INRIA 2017)

#### F1-Score (Dice Coefficient)

```
            2 √ó TP
F1-Score = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           2√óTP + FP + FN
```

–ì–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ Precision –∏ Recall.

#### –î—Ä—É–≥–∏–µ –º–µ—Ç—Ä–∏–∫–∏

**Accuracy** - –æ–±—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–∏–∫—Å–µ–ª–µ–π
```
           TP + TN
Accuracy = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           TP+TN+FP+FN
```

**Precision** - —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
```
              TP
Precision = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            TP + FP
```

**Recall** - –ø–æ–ª–Ω–æ—Ç–∞ (—Å–∫–æ–ª—å–∫–æ –∑–¥–∞–Ω–∏–π –Ω–∞—à–ª–∏)
```
           TP
Recall = ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         TP + FN
```

**–§–∞–π–ª:** `src/metrics.py`

---

### –®–∞–≥ 2.4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—É—á–µ–Ω–∏—è

#### –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä

**Adam** - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

```python
optimizer = torch.optim.Adam(
    model.parameters(),
    lr=0.001,              # Learning rate
    weight_decay=0.0001    # L2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è
)
```

**Learning Rate (LR)** - —à–∞–≥ –æ–±—É—á–µ–Ω–∏—è:
- –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Üí –Ω–µ —Å—Ö–æ–¥–∏—Ç—Å—è
- –°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—É—á–∞–µ—Ç—Å—è
- 0.001 ‚Üí –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞

#### Learning Rate Scheduler

**ReduceLROnPlateau** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–∞–µ—Ç LR –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç —É–ª—É—á—à–∞—Ç—å—Å—è.

```python
scheduler = torch.optim.lr_scheduler.ReduceLROnPlateau(
    optimizer,
    mode='max',         # –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ–º IoU
    factor=0.5,         # –£–º–µ–Ω—å—à–∞—Ç—å –≤ 2 —Ä–∞–∑–∞
    patience=5,         # –ñ–¥–∞—Ç—å 5 —ç–ø–æ—Ö
    verbose=True
)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –≠–ø–æ—Ö–∏ 1-5: LR = 0.001
- –≠–ø–æ—Ö–∏ 6-10: IoU –Ω–µ —Ä–∞—Å—Ç—ë—Ç ‚Üí LR = 0.0005
- –≠–ø–æ—Ö–∏ 11-15: –ï—â—ë –Ω–µ —Ä–∞—Å—Ç—ë—Ç ‚Üí LR = 0.00025

#### Early Stopping

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞** –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —É–ª—É—á—à–∞—Ç—å—Å—è.

```python
patience = 10  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ 10 —ç–ø–æ—Ö –±–µ–∑ —É–ª—É—á—à–µ–Ω–∏—è
```

–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è!

#### Mixed Precision Training (FP16)

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è** –∑–∞ —Å—á—ë—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 16-–±–∏—Ç–Ω—ã—Ö —á–∏—Å–µ–ª –≤–º–µ—Å—Ç–æ 32-–±–∏—Ç–Ω—ã—Ö.

```python
scaler = torch.amp.GradScaler('cuda')

with torch.amp.autocast(device_type='cuda', dtype=torch.float16):
    outputs = model(images)
    loss = criterion(outputs, masks)

scaler.scale(loss).backward()
scaler.step(optimizer)
scaler.update()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –í 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ
- üíæ –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ GPU
- ‚úÖ –ë–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞

---

### –®–∞–≥ 2.5: –ü—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è

**–§–∞–π–ª:** `train_script.py`

**–ó–∞–ø—É—Å–∫:**
```bash
python train_script.py --config configs/config.yaml
```

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–¥–Ω–æ–π —ç–ø–æ—Ö–µ:

**1. Training Loop (–æ–±—É—á–µ–Ω–∏–µ):**
```python
for batch in train_loader:  # 1822 –±–∞—Ç—á–∞
    # 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ GPU
    images = batch['image'].to('cuda')  # [32, 3, 512, 512]
    masks = batch['mask'].to('cuda')    # [32, 512, 512]
    
    # 2. Forward pass (–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ)
    outputs = model(images)  # [32, 1, 512, 512]
    
    # 3. –í—ã—á–∏—Å–ª–∏—Ç—å loss
    loss = criterion(outputs, masks)
    
    # 4. Backward pass (–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤)
    loss.backward()
    
    # 5. –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Å–∞
    optimizer.step()
    optimizer.zero_grad()
    
    # 6. –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
    metrics.update(outputs, masks)
```

**2. Validation (–ø—Ä–æ–≤–µ—Ä–∫–∞):**
```python
for batch in val_loader:  # 456 –±–∞—Ç—á–µ–π
    with torch.no_grad():  # –ë–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
        outputs = model(images)
        loss = criterion(outputs, masks)
        metrics.update(outputs, masks)
```

**3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏:**
```python
if val_iou > best_iou:
    best_iou = val_iou
    torch.save({
        'epoch': epoch,
        'model_state_dict': model.state_dict(),
        'optimizer_state_dict': optimizer.state_dict(),
        'best_metric': best_iou
    }, 'models/checkpoints/best_model.pth')
```

---

### –®–∞–≥ 2.6: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

#### TensorBoard

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–ó–∞–ø—É—Å–∫:**
```bash
tensorboard --logdir results/logs/tensorboard
```

**–ì—Ä–∞—Ñ–∏–∫–∏:**
- Train/Val Loss
- Train/Val IoU
- Train/Val F1-Score
- Learning Rate

#### Console Output

```
Epoch 1/50 | Time: 310s | LR: 1.00e-03
Train | IoU: 0.6475 | F1: 0.7861 | Acc: 0.9356
Val   | IoU: 0.6767 | F1: 0.8072 | Acc: 0.9357

‚úì –ù–æ–≤–∞—è –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å! IoU: 0.0000 ‚Üí 0.6767
  ‚Üí –°–æ—Ö—Ä–∞–Ω—ë–Ω checkpoint: models/checkpoints/best_model.pth

Epoch 2/50 | Time: 237s | LR: 1.00e-03
Train | IoU: 0.6979 | F1: 0.8221 | Acc: 0.9469
Val   | IoU: 0.6609 | F1: 0.7958 | Acc: 0.9284

‚úó IoU –Ω–µ —É–ª—É—á—à–∏–ª—Å—è (1/10)
```

---

### –®–∞–≥ 2.7: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

#### –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–≠–ø–æ—Ö–∞ 32)

**–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –º–æ–¥–µ–ª—å –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ —É–ª—É—á—à–∞—Ç—å—Å—è.

```
Train | IoU: 0.7500 | F1: 0.8572 | Acc: 0.9573
Val   | IoU: 0.7725 | F1: 0.8716 | Acc: 0.9594

‚úì –ù–æ–≤–∞—è –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å! IoU: 0.7705 ‚Üí 0.7725
```

#### –ì—Ä–∞—Ñ–∏–∫ –æ–±—É—á–µ–Ω–∏—è

```
IoU
0.80 ‚î§                                    ‚óè‚îÄ‚îÄ‚îÄ‚óè
0.75 ‚î§                        ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè
0.70 ‚î§              ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè
0.65 ‚î§      ‚óè‚îÄ‚îÄ‚îÄ‚óè
0.60 ‚î§  ‚óè
0.55 ‚î§‚óè
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      0    5   10   15   20   25   30   32
                      Epochs
```

**–ù–∞–±–ª—é–¥–µ–Ω–∏—è:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç –≤ –ø–µ—Ä–≤—ã—Ö —ç–ø–æ—Ö–∞—Ö
- ‚úÖ –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —ç–ø–æ—Ö–∏ 25
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è (Val ‚âà Train)
- ‚úÖ Early stopping —Å—Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–ñ–µ–ª–µ–∑–æ:**
- GPU: NVIDIA RTX 5070 (12 GB)
- CPU: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ
- RAM: ~16 GB

**–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è:**
- 1 —ç–ø–æ—Ö–∞: ~4-5 —á–∞—Å–æ–≤ (–ø–µ—Ä–≤–∞—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
- 32 —ç–ø–æ—Ö–∏: ~100 —á–∞—Å–æ–≤ (~4 –¥–Ω—è)
- GPU Utilization: 95-100%

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Batch size: 16 ‚Üí 32 ‚Üí 48 (–∏—Ç–æ–≥–æ–≤—ã–π)
- Num workers: 4 ‚Üí 0 (Windows fix)
- Mixed Precision: FP16
- Gradient Accumulation: 2 steps

---

### üìä –ò—Ç–æ–≥ –≠—Ç–∞–ø–∞ 2

‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: U-Net + ResNet50 encoder  
‚úÖ Loss: Dice + BCE (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)  
‚úÖ –û–±—É—á–µ–Ω–æ 32 —ç–ø–æ—Ö–∏  
‚úÖ Val IoU: **0.7725** (–≤—ã—à–µ —Ü–µ–ª–∏ 0.60!)  
‚úÖ –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: `models/checkpoints/best_model.pth`  

**–§–∞–π–ª—ã:**
- `src/model.py` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏
- `src/losses.py` - —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å
- `src/metrics.py` - –º–µ—Ç—Ä–∏–∫–∏
- `src/train.py` - training loop
- `train_script.py` - –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- `configs/config.yaml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

## 5. –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏

### üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–∏–¥–µ–ª–∞.

---

### –®–∞–≥ 3.1: –ü—Ä–æ–±–ª–µ–º–∞ —Å test set

**–í–∞–∂–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ:** Test set INRIA –¥–∞—Ç–∞—Å–µ—Ç–∞ **–Ω–µ –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö Ground Truth –º–∞—Å–æ–∫!**

```
test/
‚îî‚îÄ‚îÄ images/          # 180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚úÖ
    ‚îî‚îÄ‚îÄ gt/          # ‚ùå –ù–ï–¢ –ú–ê–°–û–ö!
```

**–ü–æ—á–µ–º—É?**  
–ê–≤—Ç–æ—Ä—ã –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–µ—Ä–∂–∞—Ç GT –≤ —Å–µ–∫—Ä–µ—Ç–µ –¥–ª—è —á–µ—Å—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ –∏—Ö —Å–µ—Ä–≤–µ—Ä.

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å?**  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **train set** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ test split.

---

### –®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ test split

**–†–µ—à–µ–Ω–∏–µ:** –í–∑—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ train (20%).

```
Train set (180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π):
‚îú‚îÄ‚îÄ [0-143]   ‚Üí –û–±—É—á–µ–Ω–∏–µ (80%)
‚îî‚îÄ‚îÄ [144-179] ‚Üí –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (20%)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ï—Å—Ç—å Ground Truth –º–∞—Å–∫–∏
- ‚úÖ –ú–æ–¥–µ–ª—å –ù–ï –≤–∏–¥–µ–ª–∞ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏
- ‚úÖ –ß–µ—Å—Ç–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

---

### –®–∞–≥ 3.3: Inference –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ –ø–∞—Ç—á–∞—Ö 512√ó512, –∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ 5000√ó5000.

**–†–µ—à–µ–Ω–∏–µ:** Sliding Window (—Å–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ).

#### –ê–ª–≥–æ—Ä–∏—Ç–º:

```
1. –†–∞–∑–±–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ç—á–∏ 512√ó512
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—á–∞:
   - –ü—Ä–æ–≥–Ω–∞—Ç—å —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å
   - –ü–æ–ª—É—á–∏—Ç—å –º–∞—Å–∫—É 512√ó512
3. –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –º–∞—Å–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ 5000√ó5000
4. –£—Å—Ä–µ–¥–Ω–∏—Ç—å –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
–ë–æ–ª—å—à–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇ 1 ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ  –ü–∞—Ç—á 1 ‚Üí –ú–æ–¥–µ–ª—å ‚Üí –ú–∞—Å–∫–∞ 1
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îò ‚îÇ 2 ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ  –ü–∞—Ç—á 2 ‚Üí –ú–æ–¥–µ–ª—å ‚Üí –ú–∞—Å–∫–∞ 2
‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îò ‚îÇ 3 ‚îÇ   ‚îÇ  –ü–∞—Ç—á 3 ‚Üí –ú–æ–¥–µ–ª—å ‚Üí –ú–∞—Å–∫–∞ 3
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  ...
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°–æ–±—Ä–∞–Ω–Ω–∞—è –º–∞—Å–∫–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚ñà‚ñà‚ñà‚ñà                ‚îÇ
‚îÇ  ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà    ‚îÇ
‚îÇ        ‚ñà‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñà    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–¥:** `src/inference.py` ‚Üí —Ñ—É–Ω–∫—Ü–∏—è `predict_large_image()`

---

### –®–∞–≥ 3.4: –†–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏ –∑–∞—Å—Ç—Ä–æ–π–∫–∏

**–§–∞–π–ª:** `src/area_calculator.py`

#### –§–æ—Ä–º—É–ª–∞:

```
–ü–ª–æ—â–∞–¥—å = –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏–∫—Å–µ–ª–µ–π –∑–¥–∞–Ω–∏–π √ó (–†–∞–∑–º–µ—Ä –ø–∏–∫—Å–µ–ª—è)¬≤

–†–∞–∑–º–µ—Ä –ø–∏–∫—Å–µ–ª—è = 0.3 –º–µ—Ç—Ä–∞
–ü–ª–æ—â–∞–¥—å –ø–∏–∫—Å–µ–ª—è = 0.3¬≤ = 0.09 –º¬≤

–ü—Ä–∏–º–µ—Ä:
1,000,000 –ø–∏–∫—Å–µ–ª–µ–π √ó 0.09 –º¬≤ = 90,000 –º¬≤ = 9 –≥–∞
```

#### –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è:

```python
area_m2 = building_pixels * 0.09        # –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –º–µ—Ç—Ä—ã
area_ha = area_m2 / 10000               # –ì–µ–∫—Ç–∞—Ä—ã (1 –≥–∞ = 10,000 –º¬≤)
area_km2 = area_m2 / 1000000            # –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–∏–ª–æ–º–µ—Ç—Ä—ã
```

#### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

```
Predicted:         65.79 –≥–∞
Ground Truth:      64.90 –≥–∞
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
True Positive:     62.15 –≥–∞  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–π–¥–µ–Ω–æ
False Positive:     3.64 –≥–∞  ‚ùå –û—à–∏–±–æ—á–Ω–æ –Ω–∞–π–¥–µ–Ω–æ
False Negative:     2.75 –≥–∞  ‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ
True Negative:  2,119.46 –≥–∞  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω —Ñ–æ–Ω
```

---

### –®–∞–≥ 3.5: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–∫—Ä–∏–ø—Ç:** `evaluate_with_gt.py`

```bash
python evaluate_with_gt.py --checkpoint models/checkpoints/best_model.pth --num-test 36
```

#### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏** –∏–∑ checkpoint
   ```
   ‚úì Checkpoint –∑–∞–≥—Ä—É–∂–µ–Ω:
     –≠–ø–æ—Ö–∞: 32
     Best metric: 0.7725
   ```

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   ```
   –í—Å–µ–≥–æ train –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 180
   –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Ç–µ—Å—Ç–∞: 36 (–ø–æ—Å–ª–µ–¥–Ω–∏–µ)
   ```

3. **Inference –Ω–∞ –∫–∞–∂–¥–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏** (~2 —Å–µ–∫—É–Ω–¥—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
   ```
   Processing patches: 100%|‚ñà‚ñà‚ñà‚ñà| 100/100 [00:02<00:00, 47.48it/s]
   Evaluation: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 36/36 [02:44<00:00,  4.56s/it]
   ```

4. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫**
   ```
   Test | IoU: 0.8022 | F1: 0.8903 | Acc: 0.9363
   ```

5. **–†–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏**
   ```
   Predicted:    65.79 –≥–∞
   Ground Truth: 64.90 –≥–∞
   –†–∞–∑–Ω–∏—Ü–∞:      +0.89 –≥–∞ (+1.37%)
   ```

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   ```
   ‚úì –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: results/evaluation_with_gt/test_results.json
   ‚úì –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã: results/evaluation_with_gt/visualizations
   ```

---

### –®–∞–≥ 3.6: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–§–∞–π–ª:** `src/visualize.py`

#### –¢–∏–ø—ã –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π:

**1. Metrics Chart** - –≥—Ä–∞—Ñ–∏–∫ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
```
Test Set Metrics
1.0 ‚î§
    ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê
0.8 ‚î§‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ    ‚îÇ
    ‚îÇ‚îÇ    ‚îÇ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ‚îÇ    ‚îÇ
0.6 ‚î§‚îÇ    ‚îÇ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ ‚îÇ    ‚îÇ‚îÇ    ‚îÇ
    ‚îî‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥
     IoU  Dice  F1  Acc  Prec  Rec  Spec
```

**2. Test Results Grid** - —Å–µ—Ç–∫–∞ –∏–∑ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Image   ‚îÇ Prediction ‚îÇ Ground Truth ‚îÇ Error Analysis‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ vienna1 ‚îÇ   ‚ñà‚ñà‚ñà‚ñà     ‚îÇ    ‚ñà‚ñà‚ñà‚ñà      ‚îÇ   üü¢üî¥üîµ     ‚îÇ
‚îÇ vienna2 ‚îÇ   ‚ñà‚ñà‚ñà‚ñà     ‚îÇ    ‚ñà‚ñà‚ñà‚ñà      ‚îÇ   üü¢üî¥üîµ     ‚îÇ
‚îÇ vienna3 ‚îÇ   ‚ñà‚ñà‚ñà‚ñà     ‚îÇ    ‚ñà‚ñà‚ñà‚ñà      ‚îÇ   üü¢üî¥üîµ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**3. Detailed Comparison** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
```
6-panel visualization:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Original   ‚îÇ Prediction  ‚îÇ    GT       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇError Analy  ‚îÇ True Posit  ‚îÇ  Errors     ‚îÇ
‚îÇüü¢TP üî¥FP üîµFN‚îÇ   Only TP   ‚îÇ  Only FP+FN ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–¶–≤–µ—Ç–æ–≤–∞—è –ª–µ–≥–µ–Ω–¥–∞:**
- üü¢ –ó–µ–ª—ë–Ω—ã–π = True Positive (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–π–¥–µ–Ω–æ)
- üî¥ –ö—Ä–∞—Å–Ω—ã–π = False Positive (–æ—à–∏–±–æ—á–Ω–æ –Ω–∞–π–¥–µ–Ω–æ)
- üîµ –°–∏–Ω–∏–π = False Negative (–ø—Ä–æ–ø—É—â–µ–Ω–æ)

---

### üìä –ò—Ç–æ–≥ –≠—Ç–∞–ø–∞ 3

‚úÖ –°–æ–∑–¥–∞–Ω test split –∏–∑ 36 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π train set  
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω inference –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
‚úÖ Test IoU: **0.8022** (–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ!)  
‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –ø–ª–æ—â–∞–¥–∏: **98.63%** (–æ—à–∏–±–∫–∞ 1.37%)  
‚úÖ –°–æ–∑–¥–∞–Ω–æ 8+ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π  
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ JSON  

**–§–∞–π–ª—ã:**
- `evaluate_with_gt.py` - —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `src/inference.py` - inference —Ñ—É–Ω–∫—Ü–∏–∏
- `src/area_calculator.py` - —Ä–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏
- `src/visualize.py` - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- `results/evaluation_with_gt/` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## 6. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–≤–æ–¥—ã

### üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | Validation | Test | –û—Ü–µ–Ω–∫–∞ |
|---------|------------|------|--------|
| **IoU** | 0.7725 | **0.8022** | üèÜ –û—Ç–ª–∏—á–Ω–æ |
| **F1-Score** | 0.8716 | 0.8903 | ‚≠ê‚≠ê‚≠ê –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ |
| **Accuracy** | 0.9594 | 0.9363 | ‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ |
| **Precision** | 0.8739 | 0.8843 | ‚≠ê‚≠ê –•–æ—Ä–æ—à–æ |
| **Recall** | 0.8694 | 0.8964 | ‚≠ê‚≠ê‚≠ê –û—Ç–ª–∏—á–Ω–æ |
| **Specificity** | - | 0.9524 | ‚≠ê‚≠ê‚≠ê –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ |

---

### üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Baseline

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ú–æ–¥–µ–ª—å              ‚îÇ IoU  ‚îÇ –£–ª—É—á—à–µ–Ω–∏–µ  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ INRIA 2017 Baseline ‚îÇ 0.60 ‚îÇ     -      ‚îÇ
‚îÇ –ù–∞—à–∞ –º–æ–¥–µ–ª—å         ‚îÇ 0.80 ‚îÇ   +36%     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:
    INRIA Baseline      Our Model
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  0.80 ‚îÇ    ‚îÇ           ‚îÇ  0.80  ‚îÇ ‚Üê +36%
  0.60 ‚îÇ0.60‚îÇ           ‚îÇ        ‚îÇ
  0.40 ‚îÇ    ‚îÇ           ‚îÇ        ‚îÇ
  0.20 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ù–∞—à–∞ –º–æ–¥–µ–ª—å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç baseline –Ω–∞ 0.20 –ø—É–Ω–∫—Ç–∞ IoU (–Ω–∞ 36%!)** üéâ

---

### üí∞ –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–æ—â–∞–¥–∏

```
Predicted:    65.79 –≥–∞
Ground Truth: 64.90 –≥–∞
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–†–∞–∑–Ω–∏—Ü–∞:      +0.89 –≥–∞
–¢–æ—á–Ω–æ—Å—Ç—å:     98.63%
```

**–û—à–∏–±–∫–∞ –≤—Å–µ–≥–æ 1.37%** - –æ—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è!

---

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

**1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- ‚úÖ U-Net —Å pretrained ResNet50 encoder
- ‚úÖ 32.5M –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ Mixed Precision Training (FP16)

**2. –û–±—É—á–µ–Ω–∏–µ:**
- ‚úÖ 32 —ç–ø–æ—Ö–∏ (~4 –¥–Ω—è –Ω–∞ RTX 5070)
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Dice + BCE loss
- ‚úÖ Automatic early stopping
- ‚úÖ Learning rate scheduling

**3. –ö–∞—á–µ—Å—Ç–≤–æ:**
- ‚úÖ Test IoU: 0.8022 (—Ü–µ–ª—å: > 0.60)
- ‚úÖ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç baseline –Ω–∞ 36%
- ‚úÖ –ù–µ—Ç –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**4. –ü—Ä–∞–∫—Ç–∏—á–Ω–æ—Å—Ç—å:**
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –ø–ª–æ—â–∞–¥–∏: 98.63%
- ‚úÖ Inference: 2 —Å–µ–∫/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö 5000√ó5000
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ deployment

---

### üìà –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```
IoU –ø–æ —ç–ø–æ—Ö–∞–º:
0.80 ‚î§                                ‚óè‚óè‚óè‚óè
     ‚îÇ                          ‚óè‚óè‚óè‚óè‚óè
0.75 ‚î§                    ‚óè‚óè‚óè‚óè‚óè
     ‚îÇ              ‚óè‚óè‚óè‚óè‚óè
0.70 ‚î§        ‚óè‚óè‚óè‚óè‚óè
     ‚îÇ  ‚óè‚óè‚óè‚óè‚óè
0.65 ‚î§‚óè‚óè
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      0    5   10   15   20   25   30   32
                    Epochs

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:
‚óè –≠–ø–æ—Ö–∞ 1:  IoU = 0.6767 (—É–∂–µ –≤—ã—à–µ baseline!)
‚óè –≠–ø–æ—Ö–∞ 3:  IoU = 0.7313 (+8%)
‚óè –≠–ø–æ—Ö–∞ 32: IoU = 0.7725 (—Ñ–∏–Ω–∞–ª)
‚óè Test:     IoU = 0.8022 (–ª—É—á—à–µ validation!)
```

---

### üî¨ –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

**–ì–¥–µ –º–æ–¥–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è:**

**False Positives (–∫—Ä–∞—Å–Ω–æ–µ –Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏):**
- –¢–µ–Ω–∏ –æ—Ç –≤—ã—Å–æ–∫–∏—Ö –∑–¥–∞–Ω–∏–π
- –ê—Å—Ñ–∞–ª—å—Ç–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ —Ä—è–¥–æ–º —Å–æ –∑–¥–∞–Ω–∏—è–º–∏
- –ß–∞—Å—Ç–∏ –¥–æ—Ä–æ–≥ —Å –ø–æ—Ö–æ–∂–µ–π —Ç–µ–∫—Å—Ç—É—Ä–æ–π

**False Negatives (—Å–∏–Ω–µ–µ –Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏):**
- –ó–¥–∞–Ω–∏—è, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç—ã–µ –¥–µ—Ä–µ–≤—å—è–º–∏
- –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ (<5 –ø–∏–∫—Å–µ–ª–µ–π)
- –ó–¥–∞–Ω–∏—è –≤ –≥–ª—É–±–æ–∫–æ–π —Ç–µ–Ω–∏

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ:**
- ‚úÖ –ü–ª–æ—Ç–Ω–∞—è –≥–æ—Ä–æ–¥—Å–∫–∞—è –∑–∞—Å—Ç—Ä–æ–π–∫–∞ (IoU > 0.85)
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω–æ —Å—Ç–æ—è—â–∏–µ –∑–¥–∞–Ω–∏—è
- ‚úÖ –†–∞–∑–ª–∏—á–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏
- ‚úÖ –ó–¥–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

---

### üí° –ü–æ—á–µ–º—É –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

**1. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ (10 –ª–æ–∫–∞—Ü–∏–π)
- –†–∞–∑–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∑–∞—Å—Ç—Ä–æ–π–∫–∏
- –†–∞–∑–ª–∏—á–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç–∏–ª–∏

**2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- Pretrained ResNet50 (–∑–Ω–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏)
- U-Net (—Ö–æ—Ä–æ—à –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏)
- Skip connections (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–µ—Ç–∞–ª–∏)

**3. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:**
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è loss —Ñ—É–Ω–∫—Ü–∏—è
- –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- Mixed precision (–±—ã—Å—Ç—Ä–µ–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞)

**4. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π test set
- –°—Ç—Ä–æ–≥–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
- –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫

---

## 7. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### üìÅ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
inria_project/
‚îÇ
‚îú‚îÄ‚îÄ data/                              # –î–∞–Ω–Ω—ã–µ (–Ω–µ –≤ Git)
‚îÇ   ‚îî‚îÄ‚îÄ AerialImageDataset/
‚îÇ       ‚îú‚îÄ‚îÄ train/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ images/                # 180 RGB –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ gt/                    # 180 –º–∞—Å–æ–∫
‚îÇ       ‚îî‚îÄ‚îÄ test/
‚îÇ           ‚îî‚îÄ‚îÄ images/                # 180 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–±–µ–∑ GT)
‚îÇ
‚îú‚îÄ‚îÄ src/                               # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ dataset.py                     # Dataset –∏ DataLoader
‚îÇ   ‚îú‚îÄ‚îÄ model.py                       # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ losses.py                      # Loss —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py                     # –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ train.py                       # Training loop
‚îÇ   ‚îú‚îÄ‚îÄ inference.py                   # Inference —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ area_calculator.py             # –†–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏
‚îÇ   ‚îî‚îÄ‚îÄ visualize.py                   # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ configs/                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml                    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ   ‚îî‚îÄ‚îÄ config_fast.yaml               # –ë—ã—Å—Ç—Ä—ã–π –∫–æ–Ω—Ñ–∏–≥
‚îÇ
‚îú‚îÄ‚îÄ models/                            # –ú–æ–¥–µ–ª–∏ (–Ω–µ –≤ Git)
‚îÇ   ‚îî‚îÄ‚îÄ checkpoints/
‚îÇ       ‚îú‚îÄ‚îÄ best_model.pth             # –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å (IoU 0.7725)
‚îÇ       ‚îú‚îÄ‚îÄ checkpoint_epoch_5.pth
‚îÇ       ‚îú‚îÄ‚îÄ checkpoint_epoch_10.pth
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ results/                           # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (–Ω–µ –≤ Git)
‚îÇ   ‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tensorboard/               # TensorBoard –ª–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ evaluation_with_gt/
‚îÇ       ‚îú‚îÄ‚îÄ test_results.json          # –ú–µ—Ç—Ä–∏–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ visualizations/            # –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ notebooks/                         # Jupyter –Ω–æ—É—Ç–±—É–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ 01_dataset_exploration.ipynb   # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ 02_evaluation.ipynb            # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚îÇ
‚îú‚îÄ‚îÄ train_script.py                    # –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ evaluate_with_gt.py                # –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ download_dataset.py                # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
‚îú‚îÄ‚îÄ test_components.py                 # –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ requirements.txt                   # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**configs/config.yaml:**
```yaml
# –ü—É—Ç–∏ –∫ –¥–∞–Ω–Ω—ã–º
data:
  root: './data/AerialImageDataset'

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—Ç–∞—Å–µ—Ç–∞
dataset:
  patch_size: 512
  train_stride: 256
  val_stride: 512

# DataLoader
dataloader:
  batch_size: 32
  num_workers: 0

# –ú–æ–¥–µ–ª—å
model:
  name: 'unet'
  encoder_name: 'resnet50'
  encoder_weights: 'imagenet'

# –û–±—É—á–µ–Ω–∏–µ
training:
  epochs: 50
  learning_rate: 0.001
  loss:
    name: 'dice_bce'
    dice_weight: 0.5
    bce_weight: 0.5
```

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**requirements.txt:**
```
torch>=2.0.0
torchvision>=0.15.0
segmentation-models-pytorch>=0.3.0
albumentations>=1.3.0
opencv-python>=4.7.0
numpy>=1.24.0
pillow>=9.5.0
matplotlib>=3.7.0
tensorboard>=2.13.0
tqdm>=4.65.0
pyyaml>=6.0
```

---

### üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. Dataset (src/dataset.py)

```python
class INRIADataset(Dataset):
    """–ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –¥–ª—è INRIA"""
    
    def __init__(self, data_root, split, patch_size, stride, transform):
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        self.image_paths = self._load_image_paths()
        
        # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–∞—Ç—á–µ–π
        self.patches = self._compute_patch_coordinates()
    
    def __getitem__(self, idx):
        # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        image = Image.open(self.image_paths[idx])
        
        # –í—ã—Ä–µ–∑–∞—Ç—å –ø–∞—Ç—á
        patch = image[y:y+512, x:x+512]
        
        # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
        augmented = self.transform(image=patch, mask=mask)
        
        return {'image': augmented['image'], 'mask': augmented['mask']}
```

#### 2. Model (src/model.py)

```python
def create_model(config, device):
    """–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    model = smp.Unet(
        encoder_name='resnet50',
        encoder_weights='imagenet',
        in_channels=3,
        classes=1,
        activation=None
    )
    return model.to(device)
```

#### 3. Loss (src/losses.py)

```python
class BCEDiceLoss(nn.Module):
    """–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è loss: Dice + BCE"""
    
    def forward(self, pred, target):
        bce_loss = F.binary_cross_entropy_with_logits(pred, target)
        
        pred_sigmoid = torch.sigmoid(pred)
        dice_coeff = (2 * (pred_sigmoid * target).sum()) / (pred_sigmoid.sum() + target.sum())
        dice_loss = 1 - dice_coeff
        
        return 0.5 * bce_loss + 0.5 * dice_loss
```

#### 4. Training (src/train.py)

```python
class Trainer:
    """–ö–ª–∞—Å—Å –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏"""
    
    def train_epoch(self, epoch):
        for batch in self.train_loader:
            images, masks = batch['image'], batch['mask']
            
            # Forward
            outputs = self.model(images)
            loss = self.criterion(outputs, masks)
            
            # Backward
            self.optimizer.zero_grad()
            loss.backward()
            self.optimizer.step()
            
            # Metrics
            self.metrics.update(outputs, masks)
    
    def validate_epoch(self, epoch):
        # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤
```

#### 5. Inference (src/inference.py)

```python
def predict_large_image(model, image, patch_size=512):
    """–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"""
    
    # –†–∞–∑–±–∏—Ç—å –Ω–∞ –ø–∞—Ç—á–∏
    patches = split_into_patches(image, patch_size)
    
    # Inference –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—á–∞
    masks = []
    for patch in patches:
        with torch.no_grad():
            mask = model(patch)
        masks.append(mask)
    
    # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
    full_mask = merge_patches(masks)
    
    return full_mask
```

---

### üéØ –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

```bash
# 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
python download_dataset.py

# 2. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
jupyter notebook notebooks/01_dataset_exploration.ipynb

# 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
python test_components.py

# 4. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
python train_script.py --config configs/config.yaml

# 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è
tensorboard --logdir results/logs/tensorboard

# 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
python evaluate_with_gt.py --checkpoint models/checkpoints/best_model.pth

# 7. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
jupyter notebook notebooks/02_evaluation.ipynb
```

---

## üéì –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

| –≠—Ç–∞–ø | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª—ã |
|------|--------|--------|-------|
| **1** | –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ | `src/dataset.py` |
| **2** | –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏ | ‚úÖ | `src/model.py` |
| **3** | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è loss —Ñ—É–Ω–∫—Ü–∏–π | ‚úÖ | `src/losses.py` |
| **4** | –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (32 —ç–ø–æ—Ö–∏) | ‚úÖ | `train_script.py` |
| **5** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ü–µ–Ω–∫–∞ | ‚úÖ | `evaluate_with_gt.py` |
| **6** | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | ‚úÖ | `src/visualize.py` |
| **7** | –†–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏ –∑–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚úÖ | `src/area_calculator.py` |
| **8** | –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ Streamlit | ‚úÖ | `app.py` |


### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| **Test IoU** | **0.8022** üèÜ |
| **F1-Score** | 0.8903 ‚≠ê‚≠ê‚≠ê |
| **Accuracy** | 0.9363 ‚≠ê‚≠ê‚≠ê |
| **–£–ª—É—á—à–µ–Ω–∏–µ vs Baseline** | +36% üöÄ |
| **–¢–æ—á–Ω–æ—Å—Ç—å –ø–ª–æ—â–∞–¥–∏** | 98.63% üí∞ |
| **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è** | ~4 –¥–Ω—è ‚è±Ô∏è |
| **–í—Ä–µ–º—è inference** | 2 —Å–µ–∫/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚ö° |


## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

**–î–∞—Ç–∞—Å–µ—Ç:**
- [INRIA Aerial Image Labeling](https://project.inria.fr/aerialimagelabeling/)
- [–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è](https://hal.inria.fr/hal-01468452)

**–§—Ä–µ–π–º–≤–æ—Ä–∫–∏:**
- [PyTorch](https://pytorch.org/)
- [Segmentation Models PyTorch](https://github.com/qubvel/segmentation_models.pytorch)
- [Albumentations](https://albumentations.ai/)

**–ú–µ—Ç—Ä–∏–∫–∏:**
- [IoU / Jaccard Index](https://en.wikipedia.org/wiki/Jaccard_index)
- [Dice Coefficient / F1-Score](https://en.wikipedia.org/wiki/S%C3%B8rensen%E2%80%93Dice_coefficient)

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∏ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∑–¥–∞–Ω–∏–π –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–∞—Ö.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ Test IoU: **0.8022** (–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç baseline –Ω–∞ 36%)
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–æ—â–∞–¥–∏: **98.63%**
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

**–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞ –¥–ª—è:**
- üé® –°–æ–∑–¥–∞–Ω–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- üéì –ó–∞—â–∏—Ç—ã –¥–∏–ø–ª–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- üè¢ –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

**–ê–≤—Ç–æ—Ä:** Zajinskiy Vadim  
**–î–∞—Ç–∞:** –Ø–Ω–≤–∞—Ä—å 2026  
**–ü—Ä–æ–µ–∫—Ç:** –î–∏–ø–ª–æ–º–Ω–∞—è —Ä–∞–±–æ—Ç–∞ - –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∑–¥–∞–Ω–∏–π –Ω–∞ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–∞—Ö  
**–î–∞—Ç–∞—Å–µ—Ç:** INRIA Aerial Image Labeling Dataset  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** IoU 0.8022 (+36% vs baseline)

---